# KAssemblyInterp
## 説明
これは、私のJAVAの練習がてら作った物で、簡単なプログラムを作成できます。最初はアセンブリ言語を目指していましたが、途中から普通に新しい言語を作ろうと方針を変更しました。今でも、若干その名残が残っています。仕様は後付けでどんどんつけていき、不具合が見つかれば修正する、新しい機能をつけたいと思えば即興でつける、不具合が見つかれば...
と言う風に作ってきた物です。デバッグは適当にしているので、バグがあるかもしれませんが、ご容赦ください。^^;<br>
このプログラムは、"apache license 2"のもとで配布されています。

## 基本的な仕様

##### 基本的な書き方
プログラムの書き方は、"コマンド 要素1 要素2 要素3 ..."<br>
と言う風に書いていきます。<br>

##### データ型
要素は整数、小数、ブーリアン、文字列型、変数に対応してます。<br>
それらはそれぞれ以下の様な名前になっています。
- int:整数型。64bit符号付です。
- float:小数型。64ビット倍精度浮動小数点数です。
- boolean:ブーリアン型。true or falseを使います。
- string:文字列型。任意の文字を代入できます。
- void:変数型として使ってもエラーになります。基本的に関数の戻り値指定の場面で使います。

##### 変数の仕様
変数には、"読み取り可能か"と"書き込み可能か"と言う2つのパラメーターがあり、Variableクラスのフィールドに保管されています。<br>
読み取り不可能に設定した変数を読み取ろうとする、または書き込み不可能に設定した変数に書き込みしようとした場合、エラーが出てプログラムが終了してしまいます。気を付けてください。<br>

##### gotoコマンドの注意点
この言語にはgoto命令が含まれています。安易にgoto命令に頼りすぎるとスパゲッティコードとなる可能性が高いです。<br>
~しかも、gotoの行数指定には、行数を数字で直接入力する必要があり、行を追加するなどした場合、gotoを一つ一つ書き換えないとエラーになる恐れがあります。~(ラベルを使うよう変更しました。)<br>

##### コメント分の書式
コメント文は、"#"を用います。#から行末までの文字は無視されます。ですが、複数の#があると、その行の最初の#から最後の#までの文字が無視されます。<br>

##### マルチラインコマンドについて
if文、while文、until文は、マルチラインコマンドと言い、他のプログラミング言語と同様、複数行に渡ってその効力を発揮するコマンドです。<br>
ブロック節(java等の"{}"やpythonの":"等)は使わず、if文で言えばif文がblock節の最初を、endifをblock節の最後の部分として機能します。

##### 入れ子システムについて
最初期のバージョンでは、戻り値を返す場合、最初から定義されているOP変数という特殊変数に格納され、そこから適宜別の変数に入れ替えたり、次のコマンドの引数として利用するなどしていました。<br>
ですが、それには手間がかかります。<br>
そこで、新しいシステムとして、入れ子システムを実装しました。<br>
入れ子システムとは、他言語と同様に関数の引数に関数を入れ込む。つまり、"function1(value, function2(value))"のような書き方を言います。<br>
ですが、この言語で上記のような書き方として実装してしまうと、Lisp言語感が出てしまい、個人的には使いたくありませんでした。<br>
そこで、"()"の代わりに新しいキーワードを導入しました。<br>
ここからは書き方です。<br>
<br>
"function1 value f:function2 value:"<br>
<br>
見て分かるように、"("の代わりに"f:"、")"の代わりに":"を使用します。<br>
また、この処理は再帰的であるため、無限に入れ子にすることが出来ますが、あまりに入れ子を深くすると、読みにくくなります。なので、ほどほどにするのがベストです。<br>
また、この入れ子システムがあるとは言え、OP変数は残っています。なので、そちらから使うことも可能ですが、最後に実行されたコマンドに上書きされていくので、遣いどころには注意が必要です。<br>
このOPコマンドは最終的には削除します。<br>

## 各デフォルトコマンドの仕様

##### 演算系

結果はOP変数に格納されます。なので適宜別の変数に入れ替えるなどを必要とします。また、入れ子システムを用いることでその手間を減らすことが出来ます。<br>
計算系のコマンドは、"mod","abs","pow"(ABSは引数1つ、他引数2つ)を除いて全て引数の長さを無限に伸ばすことが出来ます。<br>
また、全てのコマンドは引数にIntとFloatを混在させることが出来ます。また、その場合、引数にFloatが含まれているのであれば、戻り値はFloatになります。
<br>
- add:引数の全ての数を足します。<br>
- sub:最初の引数からそれ以降の引数を引きます。<br>
- mlt:引数の全ての数を乗算します。<br>
- div:最初の引数からそれ以降の引数を除算します。<br>
- mod:引数1と引数2の余りを求めます。<br>
- abs:引数の絶対値を返します。<br>
- pow:引数1を引数2で累乗します。<br>

##### 論理演算系

結果はOP変数に格納されます。なので適宜別の変数に入れ替えるなどを必要とします。また、入れ子システムを用いることでその手間を減らすことが出来ます。<br>
notコマンドは引数1つ、それ以外は無限に伸ばすことが出来ます。<br>
<br>
- not:引数に対してnot演算を実施します。
- or:引数全てに対してor演算を実施します。
- and:引数全てに対してand演算を実施します。
- xor:引数全てに対してxor演算を実施します。
- nor:引数全てに対してnor演算を実施します。
- nand:引数全てに対してnand演算を実施します。
- xnor:引数全てに対してxnor演算を実施します。

##### 比較演算系

結果はOP変数に格納されます。なので適宜別の変数に入れ替えるなどを必要とします。また、入れ子システムを用いることでその手間を減らすことが出来ます。<br>
全ての引数は二つに設定されています。<br>
また、lt,gt 等名前から機能が浮かびにくい問題については、いずれ、何かしらの対応を実施します。現在では、記号を名前に採用、演算子のようなシステムを構築し、その上で実装する等案はありますが、まとまっていません。<br>
<br>
- eq:双方の引数同士を比較します。
- eqnot:双方の引数同士を比較し、その結果を反転させた物を返します。
- lt:"<"と同じ。
- gt:">"と同じ。
- lteq:"≦"と同じ。
- gteq:"≧"と同じ。

##### 変数操作系

主に変数を操作するのに使います。この系統のコマンドでは、少し特殊な記述が必要になります。<br>
これらのコマンドは、変数を指定する必要があるので、それ専用の引数を書く場所が決められています。<br>
ですが、そこは従来通り変数の名前を書くだけで自動で認識識別してくれます。<br>
また、その際、書き込み不可に設定された変数を書き換えようとした場合、エラーが出ます。<br>
<br>
- set:引数1で指定された変数に引数2で指定した数を代入します。その際、元からあった内容は上書きされます。<br>
- mov:引数1で指定された変数の内容を引数2で指定した変数に移動させます。<br>
- swp:引数1で指定された変数の内容と引数2で指定された変数の内容を入れ替えます。<br>
- var:新しく変数を作成します。最初にCONSTもしくはFINALを書くと定数になります。その次に、変数の型を書きます。(型については上記の基本的な仕様に書いてあります。)その次に、変数名を書き、最後に任意で初期化値を書きます。書かなかった場合、デフォルトで設定された値が代入されます。<br>

##### 制御系

プログラムを制御する際に用いり、高度な制御をする場合には必須になります。<br>
<br>
- goto:指定されたラベル(その他の項目のラベルコマンドを参照。)にジャンプします。(このコマンドは最終的には削除します)<br>
- eqrl:引数2と引数3が同じなら、引数1の指定されたラベル(その他の項目のラベルコマンドを参照。)へGOTOする。(このコマンドは最終的には削除します)<br>
- eqrlnot:EQRLの条件を反転した物です。つまり、EQRLコマンドは"=="演算子で比較していましたが、EQRLNOTコマンドでは、"!="演算子を用いているような物です。(このコマンドは最終的には削除します)<br>
- exit:プログラムを終了します。引数はありません。<br>
- if:標準的なif文です。引数にブーリアン型もしくは整数型を入力できます。もし整数型を入力した場合、0をfalse、それ以外をtrueとして扱われます。<br>
- elif:これはif文とセットで使う物で、追加で条件を書きたい場合に使うことが出来ます。
- else:これはif文とセットで使う物で、全てのif、elif文の条件に当てはまらなかった場合のみに、実行されます。
- endif:if文の終わりに使うコマンドです。
- while:引数は上記のif文と同じように入力し、その条件がtrueの間、ループし続けます。条件が永遠にtrueのままだと永遠にループします。
- endwhile:while文の終わりに使うコマンドです。
- until:while文の逆で、引数がfalseの間ループします。
- enduntil:until文の終わりに使うコマンドです。

##### その他

上記のいずれにも当てはまらないコマンドです。<br>
<br>
- dsp:引数で指定した内容を表示します。引数は無限に伸ばすことが出来、その場合、引数同士が連結されます。また、引数無しだと、改行だけ出来ます。<br>
- export:引数の内容を配列に追加。そして、Engine.getExportValues()でその内容を取り出すことが出来ます。配列は次のrunメソッドが実行されるまで保存されます。これによって、Java間で情報のやり取りがより簡単にできるようになります。<br>
- label:新しくラベルを作ります。ラベルは、GOTO等の行数指定方法を代替する物で、ラベルが定義された行が、GOTOなどで飛ぶ先となります。~今の所、ラベルを定義する前の行で、そのラベルを指定することは出来ませんが、近々実装予定なので、しばらくお待ちください。~(対応しました。)<br>
- function:新しく関数を作成する事が出来るコマンドです。書式は"function 戻り値の型(int等)　引数1の型 引数1の名前 引数2の型 引数2の名前... 以下任意の引数個繰り返し"<br>
再帰は今の所使うとバグが多いと思われます。結果を返す際は、後述する"return"コマンドを使ってください。
- return:上述した関数の中で、値を返して実行中の関数を停止する役割があります。上記のfunctionで指定した戻り値の型のみを一つだけ受け付けます。
- nativefunc:javaで作成したstaticメソッドを実行する関数を登録します。簡潔に言えば、javaで実装したstaticメソッドをこの言語のコマンドとして使えます。ですが、引数と返り値で既にこの言語で定義された型と対応した型でないと正しく動作しません。書式は"nativefunc "クラスパス(java.lang.Integer等)" "メソッドの名前"　メソッドの引数の型1　メソッドの引数の型2 ... 以下欲しいメソッドの引数の個数だけ繰り返し。 "上書きする名前(任意)これを書くと、javaで使われているメソッドの名前の代わりにここに書かれている名前が使われます。" "
- import:別ファイルで記述した関数、またはnativefuncで実装した関数をインポートして使うことが出来ます。パスは文字列で指定し、絶対パスも相対パスも使えます。相対パスの場合、現在実行中のファイルの入っているディレクトリに設定されます。もしくは、ファイルから実行していない場合は、相対パスの起点はそのパソコンのユーザーディレクトリになります。

## 新しいコマンド追加チュートリアル

 工事中！！(嘘)

## 今後の予定

- ~関数機能を追加。~ 実装完了<br>
- ~別のファイル間でコードをインポート~ (実装完了) また、ライブラリとしてインポート<br>
- 配列型の実装<br>
